.. _manage_quotes:

=====================================
 Managing Characters and Quotes
=====================================

The service is run on a number of rudimentary data models with basic scaffolding views to manage the data. User based permissions are used to control access to the data.

.. _models:

Models
======

.. _CharacterGroup:

Character Group
---------------

.. autoclass:: django_quotes.models.CharacterGroup
   :members:

.. _Character:

Character
---------

.. autoclass:: django_quotes.models.Character
   :members:

.. _Quote:

Quote
-----

.. autoclass:: django_quotes.models.Quote
   :members:
.. _CharacterMarkovModel:

Character Markov Model
----------------------

.. autoclass:: django_quotes.models.CharacterMarkovModel
   :members:

The data in this model is generated by a signal that fires up the asyncronous update of the model via `markovify <https://github.com/jsvine/markovify>`_ whenever a quote is added, updated, or deleted. Users never interact with this model directly.

.. _GroupMarkovModel:

Group Markov Model
------------------

.. autoclass:: django_quotes.models.GroupMarkovModel
   :members:

.. _GroupStats:

Group Stats
-----------

.. autoclass:: django_quotes.models.GroupStats
   :members:

.. _CharacterStats:

Character Stats
---------------

.. autoclass:: django_quotes.models.CharacterStats
   :members:

.. _QuoteStats:

Quote Stats
-----------

.. autoclass:: django_quotes.models.QuoteStats
   :members:

.. _views:

Views
=====

The core views for managing the quotes consist of simple data entry and manipulation functions, heavily utilizing Django's generic views. All views require login.

.. _CharacterGroupListView:

Character Group List
-------------------------

Provides a paginated list of character groups created by logged in user.

Served at ``/app/groups/``.

.. _CharacterGroupCreateView:

Character Group Create
------------------------

Allows a user to define a new :ref:`CharacterGroup`.

Served at ``app/groups/create/``.

.. _CharacterGroupDetailView:

Character Group Detail
------------------------

Displays a detailed view of a character group with a sampling of the :ref:`Character` objects associated, with links to full listings.

Served at ``app/groups/<slug:group>/``.

.. _CharacterGroupUpdateView:

Character Group Update
------------------------

Allows user to update the character group's attributes.

Served at ``app/groups/<slug:group>/edit/``.

.. _CharacterGroupDeleteView:

Character Group Delete
------------------------

Allows user to delete a :ref:`CharacterGroup` and all child data associated with it.

Served at ``app/groups/<slug:group>/delete/``.

.. _CharacterListView:

Character List
-----------------

Paginated list of all the :ref:`Character` objects associated with a given group, along with aggregate statistics such as total quotes.

Served at ``app/groups/<slug:group>/characters/``.

.. _CharacterCreateView:

Character Create
----------------

Enables a user to create a new :ref:`Character` for a given :ref:`CharacterGroup`.

Served at ``app/groups/<slug:group>/characters/create/``.


.. _CharacterDetailView:

Character Detail
-------------------

Detail view of the :ref:`Character` object including a sampling of recently created/modified quotes with links to full listings.

Served at ``app/characters/<slug:character>/``.

.. _CharacterUpdateView:

Character Update
-------------------

Enables editing of the character attributes such as name, description, whether to allow markov requests, etc.

Served at ``app/characters/<slug:character>/edit/``.

.. _CharacterDeleteView:

Character Delete
-------------------

Enable deleting a character and all child data associated with it.

Served at ``app/characters/<slug:character>/delete/``.

.. _QuoteListView:

Quote List
-------------

Provides a paginated list of quotes created for the given :ref:`Character`.

Served at ``app/characters/<slug:character>/quotes/``.

.. _QuoteCreateView:

Quote Create
------------

Add a quote for the given :ref:`Character`.

Served at ``app/characters/<slug:character>/quotes/create/``.

.. _QuoteDetailView:

Quote Detail
---------------

Shows details of the quote including the HTML rendered version of the text, and in the future will also include statistical data.

Served at ``app/quotes/<int:quote>/``.

.. _QuoteUpdateView:

Quote Update
---------------

Enables the user to update the quote text for a given :ref:`Quote` object.

Served at ``app/quotes/<int:quote>/edit/``.

.. _QuoteDeleteView:

Quote Delete
---------------

Enables the user to delete a given :ref:`Quote` object.

Served at ``app/quotes/<int:quote>/delete/``.


Signals
=======

There are two signals provided that are used to update statistics related to :ref:`CharacterGroup`, :ref:`Character`,
and :ref:`Quote` objects. If you implement your own methods and want to ensure your stats related to
``quotes_requested`` and ``quotes_generated`` remain accurate, you will need to send these.

.. _quote_retrieved:

Quote Retrieved
---------------

.. method:: django_quotes.signals.quote_random_retrieved.send(sender, instance, quote_retrieved, *args, **kwargs)

   The ``sender`` should in most contexts be either :ref:`Character` or in rare cases, :ref:`CharacterGroup`.
   The ``instance`` should be the actual instance of the :ref:`Character` object that is being used, and
   ``quote_retrieved`` should be an instance of :ref:`Quote`. This signal will trigger updates on the relevant fields
   in :ref:`GroupStats`, :ref:`CharacterStats`, and :ref:`QuoteStats` respectively.

.. _quote_generated:

Quote Generated
---------------

.. method:: django_quotes.signals.markov_sentence_generated.send(sender, instance, *args, **kwargs)

   The ``sender`` should in most contexts be either :ref:`Character` or in rare cases, :ref:`CharacterGroup`.
   The ``instance`` should be the actual instance of the :ref:`Character` that is being used.
   This signal will update the ``quotes_generated`` stats in both :ref:`GroupStats` and :ref:`CharacterStats`.
