.. _manage_quotes:

=====================================
 Managing Sources and Quotes
=====================================

The service is run on a number of rudimentary data models with basic scaffolding views to manage the data. User based permissions are used to control access to the data.

.. _models:

Models
======

.. _SourceGroup:

Source Group
---------------

.. autoclass:: django_quotes.models.SourceGroup
   :members:

.. _Source:

Source
---------

.. autoclass:: django_quotes.models.Source
   :members:

.. _Quote:

Quote
-----

.. autoclass:: django_quotes.models.Quote
   :members:
.. _SourceMarkovModel:

Source Markov Model
----------------------

.. autoclass:: django_quotes.models.SourceMarkovModel
   :members:

The data in this model is generated by a signal that fires up the asyncronous update of the model via `markovify <https://github.com/jsvine/markovify>`_ whenever a quote is added, updated, or deleted. Users never interact with this model directly.

.. _GroupMarkovModel:

Group Markov Model
------------------

.. autoclass:: django_quotes.models.GroupMarkovModel
   :members:

.. _GroupStats:

Group Stats
-----------

.. autoclass:: django_quotes.models.GroupStats
   :members:

.. _SourceStats:

Source Stats
---------------

.. autoclass:: django_quotes.models.SourceStats
   :members:

.. _QuoteStats:

Quote Stats
-----------

.. autoclass:: django_quotes.models.QuoteStats
   :members:

.. _views:

Views
=====

The core views for managing the quotes consist of simple data entry and manipulation functions, heavily utilizing Django's generic views. All views require login.

.. _SourceGroupListView:

Source Group List
-------------------------

Provides a paginated list of source groups created by logged in user.

Served at ``/app/groups/``.

.. _SourceGroupCreateView:

Source Group Create
------------------------

Allows a user to define a new :ref:`SourceGroup`.

Served at ``app/groups/create/``.

.. _SourceGroupDetailView:

Source Group Detail
------------------------

Displays a detailed view of a source group with a sampling of the :ref:`Source` objects associated, with links to full listings.

Served at ``app/groups/<slug:group>/``.

.. _SourceGroupUpdateView:

Source Group Update
------------------------

Allows user to update the source group's attributes.

Served at ``app/groups/<slug:group>/edit/``.

.. _SourceGroupDeleteView:

Source Group Delete
------------------------

Allows user to delete a :ref:`SourceGroup` and all child data associated with it.

Served at ``app/groups/<slug:group>/delete/``.

.. _SourceListView:

Source List
-----------------

Paginated list of all the :ref:`Source` objects associated with a given group, along with aggregate statistics such as total quotes.

Served at ``app/groups/<slug:group>/sources/``.

.. _SourceCreateView:

Source Create
----------------

Enables a user to create a new :ref:`Source` for a given :ref:`SourceGroup`.

Served at ``app/groups/<slug:group>/sources/create/``.


.. _SourceDetailView:

Source Detail
-------------------

Detail view of the :ref:`Source` object including a sampling of recently created/modified quotes with links to full listings.

Served at ``app/sources/<slug:source>/``.

.. _SourceUpdateView:

Source Update
-------------------

Enables editing of the source attributes such as name, description, whether to allow markov requests, etc.

Served at ``app/sources/<slug:source>/edit/``.

.. _SourceDeleteView:

Source Delete
-------------------

Enable deleting a source and all child data associated with it.

Served at ``app/sources/<slug:source>/delete/``.

.. _QuoteListView:

Quote List
-------------

Provides a paginated list of quotes created for the given :ref:`Source`.

Served at ``app/sources/<slug:source>/quotes/``.

.. _QuoteCreateView:

Quote Create
------------

Add a quote for the given :ref:`Source`.

Served at ``app/sources/<slug:source>/quotes/create/``.

.. _QuoteDetailView:

Quote Detail
---------------

Shows details of the quote including the HTML rendered version of the text, and in the future will also include statistical data.

Served at ``app/quotes/<int:quote>/``.

.. _QuoteUpdateView:

Quote Update
---------------

Enables the user to update the quote text for a given :ref:`Quote` object.

Served at ``app/quotes/<int:quote>/edit/``.

.. _QuoteDeleteView:

Quote Delete
---------------

Enables the user to delete a given :ref:`Quote` object.

Served at ``app/quotes/<int:quote>/delete/``.


Signals
=======

There are two signals provided that are used to update statistics related to :ref:`SourceGroup`, :ref:`Source`,
and :ref:`Quote` objects. If you implement your own methods and want to ensure your stats related to
``quotes_requested`` and ``quotes_generated`` remain accurate, you will need to send these.

.. _quote_retrieved:

Quote Retrieved
---------------

.. method:: django_quotes.signals.quote_random_retrieved.send(sender, instance, quote_retrieved, *args, **kwargs)

   The ``sender`` should in most contexts be either :ref:`Source` or in rare cases, :ref:`SourceGroup`.
   The ``instance`` should be the actual instance of the :ref:`Source` object that is being used, and
   ``quote_retrieved`` should be an instance of :ref:`Quote`. This signal will trigger updates on the relevant fields
   in :ref:`GroupStats`, :ref:`SourceStats`, and :ref:`QuoteStats` respectively.

.. _quote_generated:

Quote Generated
---------------

.. method:: django_quotes.signals.markov_sentence_generated.send(sender, instance, *args, **kwargs)

   The ``sender`` should in most contexts be either :ref:`Source` or in rare cases, :ref:`SourceGroup`.
   The ``instance`` should be the actual instance of the :ref:`Source` that is being used.
   This signal will update the ``quotes_generated`` stats in both :ref:`GroupStats` and :ref:`SourceStats`.


.. _management_commands:

Management Commands
--------------------

``django-quotes`` provides a management command you can use to check and generate new Markov models for both :ref:`SourceGroup` and :ref:`Source` objects.

.. code-block:: bash

   python manage.py makemarkov
